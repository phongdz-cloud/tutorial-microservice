# k8s/monitoring/grafana-dashboards.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: microservices
data:
  dashboard.yaml: |
    apiVersion: 1
    providers:
    - name: 'microservices'
      orgId: 1
      folder: ''
      type: file
      disableDeletion: false
      updateIntervalSeconds: 10
      allowUiUpdates: true
      options:
          path: /var/lib/grafana/dashboards
  microservices-dashboard.json: |
    {
      "title": "Microservices Dashboard",
      "schemaVersion": 36,
      "version": 1,
      "panels": [
        {
          "title": "Request Rate",
          "type": "graph",
          "targets": [
            { "expr": "rate(http_server_requests_seconds_count[5m])", "legendFormat": "{{job}}" }
          ]
        },
        {
          "title": "Error Rate",
          "type": "graph",
          "targets": [
            { "expr": "rate(http_server_requests_seconds_count{status=~\\\"5..\\\"}[5m])", "legendFormat": "{{job}} errors" }
          ]
        },
        {
          "title": "Response Time",
          "type": "graph",
          "targets": [
            { "expr": "histogram_quantile(0.95, sum by (le, job) (rate(http_server_requests_seconds_bucket[5m])))", "legendFormat": "{{job}} p95" }
          ]
        }
      ],
      "time": { "from": "now-6h", "to": "now" }
    }
